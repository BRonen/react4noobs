<p align="center">
  <a href="https://github.com/he4rt/4noobs" target="_blank">
    <img src="../../assets/global/header-4noobs.svg">
  </a>
</p>

# Desmistificando o retorno 200 do Graphql

Precisamos fazer uma viagem pela hist√≥ria do HTML, antes de desmistificar o retorno do Graphql.

O d√©cada √© de 1990, e o http (Hypertext Transfer Protocol) come√ßa a ser difundido mundialmente.

E endere√ßos como www.ig.com.br come√ßam a surgir e com eles uma s√©rie de recursos podem ser acessados e interpretados por browsers.

## O procotolo HTTP

### Protocolo

Primeiro precisamos enteder o que √© um protocolo.

Protocolo √© uma camada de abstra√ß√£o que define um mecanismo de comunica√ß√£o entre dois pontos.

Imagina que voc√™ acaba de conhecer uma pessoa na rua, voc√™ olha para ela e diz: "Ol√°!"

Voc√™ acabou de usar um protocolo para comunicar com a pessoa. Se ela estiver ciente do protocolo ela provavelmente vai reconhecer a mensagem e responder.

Da mesma forma funcionam os computadores, existem v√°rios protocolos para executar diferentes tarefas.

### HTTP

O protocolo utilizado para buscar recursos na web √© o http (Hypertext Transfer Protocol).

Vamos pegar um recurso como exemplo:

http://api.sotops.com.br/images/nudedodaniel.jpg

E quebr√°-lo em partes:

<span style="color:#bf1363">http://</span>: Protocolo  
<span style="color:#0e79b2">api</span>: Maquina no servidor  
<span style="color:#f39237">sotops</span>: Servidor  
<span style="color:#00ffc5">com</span>: nameServer comercial  
<span style="color:#00ffc5">br</span>: nameServer brasileiro  
<span style="color:#bf1363">images</span>: Pasta no servidor  
<span style="color:#59cd90">nudedodaniel.jpg</span>: arquivo no servidor  


Quando voc√™ acessa essa p√°gina, o browser ir√° buscar o recurso e enviar√° uma requisi√ß√£o para o servidor.

Primeiro procura por um servidor que seja respons√°vel por recursos no br e l√° pergunta sobre onde est√° o respons√°vel por recursos comerciais.

Ao encontrar os recursos comerciais, pergunta onde est√° o servidor sotops.

Ao encontrar o servidor sotops, pergunta qual maquina no servidor √© respons√°vel pela api.

Ao encontrar a m√°quina api, requisita o arquivo nudedodaniel.jpg na pasta images.

Dentro do pacote de requisi√ß√£o n√£o existe nada, apenas cabe√ßalhos com a informa√ß√£o dela em si, como o endere√ßo de quem requisitou o recurso.

Agora imagina que algums erros podem ocorrer nessa requisi√ß√£o, como por exemplo:

- Ao chegar no servidor ele diz que o endere√ßo no cabe√ßalho n√£o tem autoriza√ß√£o para acessar o recurso, ent√£o o protocolo retorna um c√≥digo de resposta `HTTP 403`.

- Vamos supor que a pasta images existe, mas o arquivo n√£o existe, ent√£o o protocolo retorna um c√≥digo de resposta `HTTP 404`.

- Vamos supor que ocorre um erro no servidor, entao o protocolo retorna um c√≥digo de resposta `HTTP 500`.

- Vamos supor que tudo ocorre bem e voc√™ consegue acessar o recurso. Ent√£o o protocolo retorna um c√≥digo de resposta `HTTP 200`.

Por uns bons anos o protocolo http foi utilizado dessa forma, mas com o passar do tempo e a moderniza√ß√£o do desenvolvimento web e com o advento do REST, a forma como o protocolo http foi entendi mudou.

E ele se tornou repons√°vel n√£o s√≥ pelo que est√° em seu nome "TRANSFER", mas colocaram dentro do protocolo tamb√©m tudo aquilo que podia ou n√£o acontecer "dentro" do servidor.

E com isso o protocolo http ficou respons√°vel n√£o s√≥ para ser utilizado para transferir arquivos, mas tamb√©m pode ser utilizado para fazer requisi√ß√µes ao servidor e respons√°vel por analisar tudo aquilo que acontece internamente no servidor.

Quando por exemplo voc√™ faz um `put` em um usuario com email inv√°lido, o servidor altera o protocolo e faz com que ele responda `HTTP 400`, ou seja, o servidor n√£o conseguiu fazer o `put` do usuario com email inv√°lido.

Se voc√™ analisar pela perspectiva de um protocolo de transfer√™ncia, o mais "correto" √© que ele respondesse um 200, uma vez que o protocolo n√£o √© respons√°vel pelo conte√∫do da requisi√ß√£o mas pela TRANSFERENCIA dela.

Quando voc√™ recebe uma pizza de calabresa na sua casa com peperoni, a responsabilidade √© do entregador ou do restaurante?

O que voc√™ pode fazer √© pedir que o entregador devolva a pizza para o restaurante com a `mensagem` de que o sabor da pizza estava incorreto.

Quando perguntado se ocorreu tudo bem ao transferir a pizza para a casa do cliente o motorista vai dizer que sim, mas que ele tem uma mensagem de que a pizza n√£o tinha o sabor correto.

E por que isso √© importante para o graphql?


## Requisi√ß√µes graphql

Vamos usar como exemplo a requisi√ß√£o de usu√°rio que temos no cap√≠tulo de conceito.

Mas dessa vez vamos utilizar requisi√ß√µes multiplas, ou seja, ao inves de fazer apenas uma requisi√ß√£o para o backend eu vou fazer duas, ao mesmo tempo.

```graphql
query{
  q1:user(id: 1){
    id
    name
    post {
      id
      title
    }
  }
  q2: user(id: 2){
    id
    name
    post {
      id
      title
    }
  }
```

Agora imagina que o usu√°rio de id:1 existe, mas o usu√°rio de id:2 n√£o.
Portanto eu teria um http 200 para o primeiro e um 404 para o segundo.

E ai vem a pergunta de um milh√£o, qual reponse eu dou para meu cliente?

Por isso o graphql fez com que o protocolo http voltasse as suas origens e ficasse respons√°vel apenas pela transfer√™ncia de dados, n√£o pelo conte√∫do dos dados.

Pelo conte√∫do dos dados a responsabilidade fica no mensagem da resposta, que normalmente feita em json.

Um exemplo de resposta:

```json
{
  "error": {
    "q1": {},
    "q2": {}
  },
  "data": {
    "q1": {},
    "q2": {}
  }
}
```

Uma resposta t√≠pica graphql sempre contem um objeto com dois objetos dentro.
Um deles o `error` respons√°vel por dizer o que houve de errado com a requisi√ß√£o.
E o outro `data` respons√°vel pelos dados da requisi√ß√£o.

Dentro de cada um desses objetos poderemos ter separadamente cada uma das queries e suas respectivas respostas.




<p align="center">Made with üíú</p>

<p align="center">
  <a href="https://github.com/he4rt/4noobs" target="_blank">
    <img src="../../assets/global/footer-4noobs.svg" width="380">
  </a>
</p>

[1]: https://www.howtographql.com/
[2]: https://docs.github.com/en/graphql/overview/explorer